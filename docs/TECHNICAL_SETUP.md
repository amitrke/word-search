# Technical Setup Guide - Word Search App

## Prerequisites

- Flutter SDK 3.9.2+
- Dart 3.0+
- Node.js 18+ (for Firebase Cloud Functions)
- Firebase CLI
- OpenAI API key (or alternative AI service)
- IDE: VS Code or Android Studio

## Step 1: Firebase Project Setup

### 1.1 Create Firebase Project

1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Click "Add project"
3. Name: "word-search-app" (or your choice)
4. Enable Google Analytics (recommended)
5. Create project

### 1.2 Enable Firebase Services

**Authentication**:
1. Navigate to Authentication → Sign-in method
2. Enable Email/Password
3. Enable Google Sign-In
4. (Optional) Enable Apple Sign-In for iOS

**Firestore Database**:
1. Navigate to Firestore Database
2. Create database
3. Start in **test mode** (for development)
4. Choose region closest to your users
5. Later, update security rules (see Section 5)

**Cloud Functions**:
1. Navigate to Functions
2. Upgrade to Blaze plan (pay-as-you-go, required for external API calls)

### 1.3 Register Apps

**Android**:
1. Project settings → Add app → Android
2. Package name: `com.yourcompany.word_search`
3. Download `google-services.json`
4. Place in `android/app/`

**iOS**:
1. Project settings → Add app → iOS
2. Bundle ID: `com.yourcompany.wordSearch`
3. Download `GoogleService-Info.plist`
4. Place in `ios/Runner/`

**Web** (if needed):
1. Project settings → Add app → Web
2. Copy configuration
3. Update `web/index.html`

## Step 2: Flutter Project Configuration

### 2.1 Update pubspec.yaml

```yaml
name: word_search
description: "AI-powered word search puzzle app"
publish_to: 'none'
version: 1.0.0+1

environment:
  sdk: ^3.9.2

dependencies:
  flutter:
    sdk: flutter

  # Firebase
  firebase_core: ^2.24.0
  firebase_auth: ^4.15.0
  cloud_firestore: ^4.13.0
  cloud_functions: ^4.5.0
  firebase_analytics: ^10.7.0
  firebase_crashlytics: ^3.4.0

  # State Management
  provider: ^6.1.1

  # Local Storage
  shared_preferences: ^2.2.2
  hive: ^2.2.3
  hive_flutter: ^1.1.0

  # UI
  cupertino_icons: ^1.0.8
  google_fonts: ^6.1.0
  flutter_animate: ^4.3.0

  # Utilities
  intl: ^0.18.1
  uuid: ^4.2.2
  http: ^1.1.0

dev_dependencies:
  flutter_test:
    sdk: flutter
  flutter_lints: ^5.0.0

flutter:
  uses-material-design: true
```

### 2.2 Install Dependencies

```bash
flutter pub get
```

### 2.3 Initialize Firebase in Flutter

Update `lib/main.dart`:

```dart
import 'package:flutter/material.dart';
import 'package:firebase_core/firebase_core.dart';
import 'firebase_options.dart'; // Generated by FlutterFire CLI

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );
  runApp(const MyApp());
}
```

### 2.4 Generate Firebase Options

```bash
# Install FlutterFire CLI
dart pub global activate flutterfire_cli

# Generate firebase_options.dart
flutterfire configure
```

## Step 3: Project Structure

Create the following directory structure:

```
lib/
├── main.dart
├── firebase_options.dart
├── models/
│   ├── puzzle.dart
│   ├── user_profile.dart
│   ├── word.dart
│   └── user_puzzle.dart
├── services/
│   ├── auth_service.dart
│   ├── firestore_service.dart
│   ├── puzzle_service.dart
│   └── local_storage_service.dart
├── providers/
│   ├── auth_provider.dart
│   ├── puzzle_provider.dart
│   └── user_stats_provider.dart
├── screens/
│   ├── home_screen.dart
│   ├── puzzle_screen.dart
│   ├── profile_screen.dart
│   ├── daily_challenge_screen.dart
│   └── auth/
│       ├── login_screen.dart
│       └── signup_screen.dart
├── widgets/
│   ├── puzzle_grid.dart
│   ├── word_list.dart
│   ├── puzzle_card.dart
│   └── stats_widget.dart
└── utils/
    ├── constants.dart
    ├── puzzle_generator.dart (client-side validation)
    └── theme.dart
```

## Step 4: Firebase Cloud Functions Setup

### 4.1 Initialize Cloud Functions

```bash
cd word-search
firebase init functions
```

Select:
- Use existing project
- Language: JavaScript or TypeScript
- ESLint: Yes
- Install dependencies: Yes

### 4.2 Project Structure

```
functions/
├── src/
│   ├── index.ts
│   ├── puzzleGenerator.ts
│   ├── aiService.ts
│   └── wordPlacement.ts
├── package.json
└── tsconfig.json
```

### 4.3 Install Dependencies

```bash
cd functions
npm install openai
npm install axios
npm install cors
```

### 4.4 Set Environment Variables

```bash
# Set OpenAI API Key
firebase functions:config:set openai.key="your-openai-api-key"

# View configuration
firebase functions:config:get
```

For local development, create `functions/.runtimeconfig.json`:

```json
{
  "openai": {
    "key": "your-openai-api-key"
  }
}
```

### 4.5 Sample Cloud Function Structure

`functions/src/index.ts`:

```typescript
import * as functions from 'firebase-functions';
import * as admin from 'firebase-admin';
import { generatePuzzle } from './puzzleGenerator';

admin.initializeApp();

export const createPuzzle = functions.https.onCall(async (data, context) => {
  const { theme, difficulty } = data;

  // Validate input
  if (!theme || !difficulty) {
    throw new functions.https.HttpsError(
      'invalid-argument',
      'Theme and difficulty are required'
    );
  }

  try {
    const puzzle = await generatePuzzle(theme, difficulty);

    // Store in Firestore
    const puzzleRef = await admin.firestore().collection('puzzles').add({
      ...puzzle,
      createdAt: admin.firestore.FieldValue.serverTimestamp(),
      popularity: 0
    });

    return { puzzleId: puzzleRef.id, ...puzzle };
  } catch (error) {
    console.error('Error generating puzzle:', error);
    throw new functions.https.HttpsError('internal', 'Failed to generate puzzle');
  }
});

export const scheduleDailyChallenge = functions.pubsub
  .schedule('0 0 * * *')
  .timeZone('UTC')
  .onRun(async (context) => {
    // Logic to select/create daily challenge
    console.log('Daily challenge scheduled');
  });
```

## Step 5: Firestore Security Rules

Update Firestore security rules:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Helper functions
    function isAuthenticated() {
      return request.auth != null;
    }

    function isOwner(userId) {
      return isAuthenticated() && request.auth.uid == userId;
    }

    // Puzzles - Read all, write only via Cloud Functions
    match /puzzles/{puzzleId} {
      allow read: if true;
      allow write: if false; // Only Cloud Functions can write
    }

    // Users - Read own, write own
    match /users/{userId} {
      allow read: if isAuthenticated();
      allow write: if isOwner(userId);
    }

    // User Puzzles - Read own, write own
    match /userPuzzles/{userPuzzleId} {
      allow read: if isAuthenticated() &&
        resource.data.userId == request.auth.uid;
      allow create: if isAuthenticated() &&
        request.resource.data.userId == request.auth.uid;
      allow update: if isOwner(resource.data.userId);
    }

    // Daily Challenges - Read all
    match /dailyChallenges/{challengeId} {
      allow read: if true;
      allow write: if false; // Only Cloud Functions
    }

    // Themes - Read all
    match /themes/{themeId} {
      allow read: if true;
      allow write: if false; // Admin only
    }
  }
}
```

## Step 6: Local Development

### 6.1 Run Flutter App

```bash
# Run on specific device
flutter run -d chrome  # Web
flutter run -d windows # Windows
flutter run            # Connected device

# Run with hot reload
# Press 'r' for hot reload
# Press 'R' for hot restart
```

### 6.2 Run Firebase Emulators (Optional)

```bash
# Install emulators
firebase init emulators

# Start emulators
firebase emulators:start

# In your Flutter app, connect to emulators
# Add to main.dart:
# await FirebaseAuth.instance.useAuthEmulator('localhost', 9099);
# FirebaseFirestore.instance.useFirestoreEmulator('localhost', 8080);
```

### 6.3 Test Cloud Functions Locally

```bash
cd functions
npm run serve

# Or
firebase emulators:start --only functions
```

## Step 7: Deployment

### 7.1 Deploy Cloud Functions

```bash
firebase deploy --only functions

# Deploy specific function
firebase deploy --only functions:createPuzzle
```

### 7.2 Build Flutter App

**Android**:
```bash
flutter build apk --release
flutter build appbundle --release
```

**iOS**:
```bash
flutter build ios --release
# Open Xcode and upload to App Store
```

**Web**:
```bash
flutter build web --release
firebase deploy --only hosting
```

## Step 8: Initial Data Seeding

### 8.1 Create Seed Script

`functions/src/seedData.ts`:

```typescript
import * as admin from 'firebase-admin';

async function seedThemes() {
  const themes = [
    { name: 'Animals', description: 'Words about animals', iconUrl: '' },
    { name: 'Countries', description: 'Countries around the world', iconUrl: '' },
    { name: 'Technology', description: 'Tech-related words', iconUrl: '' },
    { name: 'Food', description: 'Delicious foods', iconUrl: '' },
    { name: 'Sports', description: 'Sports and games', iconUrl: '' },
  ];

  const batch = admin.firestore().batch();

  themes.forEach(theme => {
    const ref = admin.firestore().collection('themes').doc();
    batch.set(ref, {
      ...theme,
      puzzleCount: 0,
      popularity: 0,
      createdAt: admin.firestore.FieldValue.serverTimestamp()
    });
  });

  await batch.commit();
  console.log('Themes seeded successfully');
}
```

Run manually or create a one-time Cloud Function.

## Step 9: Testing

### 9.1 Unit Tests

Create `test/models/puzzle_test.dart`:

```dart
import 'package:flutter_test/flutter_test.dart';
import 'package:word_search/models/puzzle.dart';

void main() {
  group('Puzzle Model', () {
    test('should create puzzle from JSON', () {
      final json = {
        'puzzleId': '123',
        'theme': 'Animals',
        'difficulty': 'medium',
        // ... more fields
      };

      final puzzle = Puzzle.fromJson(json);

      expect(puzzle.puzzleId, '123');
      expect(puzzle.theme, 'Animals');
      expect(puzzle.difficulty, 'medium');
    });
  });
}
```

Run tests:
```bash
flutter test
```

### 9.2 Widget Tests

```dart
testWidgets('PuzzleGrid displays correctly', (WidgetTester tester) async {
  // Test implementation
});
```

## Step 10: Monitoring & Analytics

### 10.1 Enable Crashlytics

```bash
flutter pub add firebase_crashlytics
flutterfire configure
```

Update main.dart:
```dart
FlutterError.onError = FirebaseCrashlytics.instance.recordFlutterFatalError;
```

### 10.2 Add Analytics Events

```dart
import 'package:firebase_analytics/firebase_analytics.dart';

final analytics = FirebaseAnalytics.instance;

// Log events
await analytics.logEvent(
  name: 'puzzle_completed',
  parameters: {
    'difficulty': difficulty,
    'completion_time': time,
  },
);
```

## Troubleshooting

### Common Issues

**Firebase not initialized**:
- Ensure `Firebase.initializeApp()` is called before `runApp()`
- Check `firebase_options.dart` exists

**Cloud Functions CORS error**:
- Use `functions.https.onCall` instead of `onRequest`
- Or configure CORS properly for HTTP functions

**Firestore permission denied**:
- Check security rules
- Ensure user is authenticated
- Verify user owns the resource

**Build errors after adding Firebase**:
- Run `flutter clean`
- Run `flutter pub get`
- Update gradle versions if needed

## Next Steps

1. Implement authentication flow (login/signup screens)
2. Create Puzzle model classes
3. Implement puzzle grid UI
4. Build puzzle generation Cloud Function
5. Integrate OpenAI API
6. Test end-to-end puzzle creation and solving
7. Add user statistics tracking
8. Implement daily challenge system

## Resources

- [FlutterFire Documentation](https://firebase.flutter.dev/)
- [Firebase Console](https://console.firebase.google.com/)
- [OpenAI API Documentation](https://platform.openai.com/docs)
- [Flutter Provider Documentation](https://pub.dev/packages/provider)
- [Cloud Functions Documentation](https://firebase.google.com/docs/functions)
